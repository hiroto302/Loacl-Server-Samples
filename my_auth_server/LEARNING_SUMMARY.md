# 認証サーバー構築とネットワーク原理の学習成果

このプロジェクトは、Node.js (Express) と Unity を使用して、**Basic認証**および**Bearer認証 (JWT)** の仕組みを実装し、その背景にある HTTP/TCP の原理を学習するためのものです。

## 1. 使用技術スタック (Node.js)

| ライブラリ | 役割 | 学習ポイント |
| :--- | :--- | :--- |
| **express** | Webサーバー | `app.get`, `app.post` によるルーティングとHTTPメソッドの使い分け。 |
| **body-parser** | ボディ解析 | JSON形式のリクエストボディを `req.body` オブジェクトに変換する。 |
| **jsonwebtoken** | 認証トークン | 電子署名付きトークン (JWT) の発行(`sign`) と検証(`verify`)。 |

---

## 2. 認証方式の仕組みと実装詳細

### 🔐 A. Basic認証 (Basic Auth)
HTTPヘッダーの制約とエンコーディングの必要性を学習。

* **仕様**: `Authorization: Basic <Base64文字列>`
* **ヘッダーの制約 (重要)**:
    * HTTPヘッダーには **印刷可能なASCII文字 (0x20-0x7E)** しか使用できない。
    * そのため、ユーザー名やパスワード（バイナリになり得るデータ）を直接ヘッダーに記述することはできず、**Base64エンコード** が必須となる。
* **処理フロー**:
    1.  Client: `username:password` を結合 → UTF-8バイト配列化 → Base64変換。
    2.  Server: ヘッダー受信 → Base64デコード → 照合。

### 🔑 B. Bearer認証 (Token Auth / JWT)
ステートレスな認証とセキュリティリスクの分散を学習。

* **仕様**: `Authorization: Bearer <token>`
* **なぜBodyでログインするのか？**:
    * ログイン時はまだトークンがないため、Header（Authorization）は使えない。
    * HTTP **Body** は任意のバイト値（0x00-0xFF）を許容するため、UTF-8のJSONなどを自由に送信できる。
* **処理フロー**:
    1.  **Login (POST)**: Bodyに認証情報を含めて送信。
    2.  **Issue**: サーバーで検証後、有効期限付きJWTを発行。
    3.  **Access (GET)**: 以降はHeaderにトークンを載せてリクエスト。
* **メリット**:
    * パスワードを毎回ネットワークに流さない（漏洩リスク低減）。
    * サーバー側でセッション管理（DB照合）が不要になる。

---

## 3. ネットワークと通信の原理原則 (Deep Dive)

実装を通じて理解した、Web通信の低レイヤーの仕組み。

### 📡 データ表現とエンコーディング
* **ASCII vs UTF-8**:
    * コンピュータは文字を数値（バイト）で扱う。
    * ASCIIは7bit（英数字のみ）。UTF-8は全世界の文字を扱える可変長コード。
    * HTTPヘッダーは歴史的経緯によりASCII前提であるため、日本語などを送る際はBase64などの「トンネリング」が必要。

### 🤝 TCP/IP と コネクション
* **接続指向 (Connection-oriented)**:
    * HTTPは **TCP** というプロトコルの上で動作している。
    * `SYN` → `SYN-ACK` → `ACK` の手順で接続を確立（ハンドシェイク）してからデータを送る。
* **レスポンスの仕組み**:
    * 「サーバーがなぜクライアントを知っているか？」
    * 接続確立時にクライアントのIPとポート番号がサーバーに伝わり、TCP接続（仮想的な通信パイプ）が維持されているため、サーバーはそのパイプを通じてレスポンスを返せる。

### 🌍 サーバー待ち受け設定
* **localhost (127.0.0.1)**: 自分自身のみアクセス可能。
* **0.0.0.0**: 全てのネットワークインターフェースで待ち受ける設定（外部からのアクセスを許可する場合に使用）。

---

## 4. 今後の学習ステップ

1.  **Wiresharkによるパケット解析**:
    * 実際に `Authorization` ヘッダーがBase64で流れているか確認する。
    * TCPの3ウェイ・ハンドシェイク（SYN/ACK）を目視で確認する。
2.  **HTTPS (SSL/TLS) の導入**:
    * 現在のBasic認証/Bearer認証を暗号化通信上で行い、盗聴リスクを防ぐ。

3. 今回の実装をリファクタリングする
